<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>iframe跨域</title>
  <link rel="stylesheet" href="../../css/bootstrap.min.css">
  <link rel="stylesheet" href="../../css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="../../css/main.css">
  <script src="../../lib/jquery-1.11.3.js"></script>
</head>
<body>
<hr />
<h3>跨域限制</h3>
<button class="btn btn-primary btn-sm" onclick="crossAjax();">跨域请求</button>
<hr />
<h3>跨子域ajax</h3>
<p>通过iframe+document.domain方式实现跨子域请求</p>
<iframe id="bfrm" style="display:none;" src="http://b.test.com:8081/pages/iframe/middle.html"></iframe>
<button class="btn-sm btn btn-primary" onclick="crossSubDomain();">跨子域请求</button>
<hr />
<script>
  function crossAjax() {
    var url = 'http://b.test.com:8081/test';
    // var url = '/test';
    $.ajax(url).done(function(data) {
      alert(data);
    }).fail(function() {
      alert('请求失败');
    });
  }

  function crossSubDomain() {
    document.domain = 'test.com'; // 提升域
    window.frames['bfrm'].contentWindow.doAjax(function(data) {
      alert(data);
    });
  }
</script>
</body>
</html>